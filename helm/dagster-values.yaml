# helm/dagster-values.yaml

# Expose Dagster services
dagsterApiServer:
  service:
    type: LoadBalancer

dagsterWebserver:
  service:
    type: LoadBalancer

postgresql:
  enabled: true
  persistence:
    enabled: true
    size: 8Gi

rabbitmq:
  enabled: true
  persistence:
    enabled: true
    size: 8Gi

# Override user code deployments
dagster-user-deployments:
  enabled: true
  deployments:
    - name: hydrosat-code
      image:
        repository: hydro0ba375acr.azurecr.io/hydrosat
        tag: latest
        pullPolicy: Always
      dagsterApiGrpcArgs:
        - "-m"  # Use module loading
        - "hydrosat_project"
      port: 4000
      env:
        - name: AZURE_STORAGE_CONNECTION_STRING
          value: "DefaultEndpointsProtocol=https;AccountName=hydro0ba375sa;AccountKey=F+SWu6Kw8FJpm+ysWGYFL7E/SFvphzs/3S2jLk1nX4/nyIsCNK7jyaL9ZFyYVgf/8R9q9V87ZR9J+AStF70vqw==;EndpointSuffix=core.windows.net"
      workingDirectory: "/app"
